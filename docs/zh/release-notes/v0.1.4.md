# Release v0.1.4

## ✨ 智能 Prompt 自动补全

自定义 prompt 变得更简单了！gcop-rs 现在会自动在你的 prompt 后追加缺失的必需部分。

### 提交 Prompt

只需写你的指令 - gcop-rs 会处理其余部分：

```toml
[commit]
custom_prompt = "用中文生成提交信息，要简洁"
```

如果缺少 `{diff}`，gcop-rs 会自动追加 diff 和上下文部分。

### 审查 Prompt

对于审查，gcop-rs 会：
1. 如果缺少 `{diff}` 部分则追加
2. **始终**追加 JSON 输出格式规范

```toml
[review]
custom_prompt = "审查安全漏洞，重点关注 SQL 注入"
```

不需要自己写 JSON 格式 - 它会自动添加。

## 🔍 详细模式显示完整 Prompt

使用 `-v` 查看发送给 LLM 的完整 prompt，包括自动补全的部分：

```bash
gcop-rs -v commit
gcop-rs -v review
```

这有助于调试自定义 prompt 并了解 AI 实际收到了什么。

## 🐛 修复 JSON 响应解析

修复了 `clean_json_response` 中的一个 bug，之前的 `unwrap_or(response)` 链式调用会错误地回退到原始响应而不是中间结果。

现在使用防御性解析，提取第一个 `{` 和最后一个 `}` 之间的内容，使其能够健壮地处理各种 LLM 响应格式：

```rust
// 现在可以处理任何包装格式:
// "当然！这是 JSON: ```json {...} ``` 希望有帮助！"
// → 正确提取 {...}
```

## 📦 安装

```bash
cargo install gcop-rs
```

或从源码构建：

```bash
git clone https://github.com/AptS-1547/gcop-rs.git
cd gcop-rs
cargo build --release
```

## 📚 文档

- [README](https://github.com/AptS-1547/gcop-rs#readme)
- [中文文档](https://github.com/AptS-1547/gcop-rs/blob/master/README_ZH.md)
- [自定义 Prompt 指南](https://github.com/AptS-1547/gcop-rs/blob/master/docs/prompts.md)
- [完整更新日志](https://github.com/AptS-1547/gcop-rs/blob/master/CHANGELOG.md)
